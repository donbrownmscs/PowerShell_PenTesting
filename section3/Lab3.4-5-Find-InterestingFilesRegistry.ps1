<#
 .SYNOPSIS
  Scan Registy for chosen pattern.

 .DESCRIPTION
  This script scans through the registry hives (HKCR, HKCU, HKLM, HKU, and HKCC) and recursively searches for a chosen pattern within the registry key names or data values.
.

 .EXAMPLE
  # this example shows how to execute the script.
  PS C:\> ./Lab3.4-5-Find-InterestingFilesRegistry.ps1

 .INPUTS
  None.

 .OUTPUTS
  None.

#>

# Silently Continue if an error is encountered on the Get-ChildItem calls below.
$ErrorActionPreference = "SilentlyContinue"

$pattern = "password"

$hives = "HKEY_LOCAL_MACHINE"  #"HKEY_CLASSES_ROOT","HKEY_CURRENT_USER","HKEY_LOCAL_MACHINE","HKEY_USERS","HKEY_CURRENT_CONFIG"

foreach ($r in $hives) { 
	Get-ChildItem "registry::${r}\" -rec | Select-String "$pattern" 
}

foreach ($r in $hives) { 
	$xs = Get-ChildItem "registry::${r}\" -rec 
	foreach ($x in $xs) { 
		if((Get-ItemProperty $x.PsPath) -match "$pattern") { 
			$x.PsPath
			Out-String $x -stream | Select-String "$pattern" 
			}
	}
}

